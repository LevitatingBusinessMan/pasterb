ruby:
  require 'cgi'
  $cgi = CGI.new
  puts $cgi.http_header "text/html"

  $errors = []

  require './src/data.rb'
  require './src/log.rb'

  key = $cgi['']

  $writable = true

  begin
  $paste = case $cgi.path_info
  when "/view"
      $writable = false
    Paste.find_by! read_key: key
  when "/edit"
    Paste.find_by! write_key: key
  when "/"
    Paste.new
  else 
    raise "Unknown #{$cgi.path_info}"
  end

  rescue Exception => ex
    $errors << ex
    if $paste.nil?
      $paste = Paste.new
      $writable = true
    end
  end

doctype html
html
head
  css:
    #editor, #history {
      height: 100%;
      max-width: 100%;
      display: inline-block;
      vertical-align: middle;
    }
    #editor {
      width: 60%;
    }
    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
    }
body
  - for e in $errors
    p#error=e
  h1#title=$paste.title
  - if $paste.new_record?
    span#unsaved unsaved
  br
  div#editor= $paste.content
  div#history
    h1 History
    - for rev in $paste.revisions.order(revision_id: :desc)
      h3= rev.name
    - if $writable
      h2 New Revision
      label Name:
      input[placeholder="Revision #{$paste.revisions.length + 1}"]
      br
      br
      button submit
      br
    - unless $paste.new_record?
      a[href=$paste.view_link] view link
      br
      - if $writable 
        a[href=$paste.edit_link] edit link

script src="/static/ace-builds/src/ace.js"
javascript:
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.session.setMode("ace/mode/javascript");
  editor.setOptions({
    wrap: true,
    fontSize: 20
  });

css: 
  h1#title {
    display: inline-block;
  }
  p#error {
    color: red;
  }
